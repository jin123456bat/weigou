<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
    <!--<![endif]-->
    <!-- BEGIN HEAD -->

    <head>
        <meta charset="utf-8" />
        <title>首页商品</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta content="width=device-width, initial-scale=1" name="viewport" />
        <meta content="" name="description" />
        <meta content="" name="author" />
        <!-- BEGIN GLOBAL MANDATORY STYLES -->
        <link href="{%$VIEW_ROOT%}/assets/global/css/font.css" rel="stylesheet" type="text/css" />
        <link href="{%$VIEW_ROOT%}/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <link href="{%$VIEW_ROOT%}/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
        <link href="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="{%$VIEW_ROOT%}/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
        <link href="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
        <!-- END GLOBAL MANDATORY STYLES -->
        <!-- BEGIN THEME GLOBAL STYLES -->
        <link href="{%$VIEW_ROOT%}/assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
        <link href="{%$VIEW_ROOT%}/assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
		<link href="{%$VIEW_ROOT%}/assets/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
		<link href="{%$VIEW_ROOT%}/assets/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet" type="text/css" />
        <!-- END THEME GLOBAL STYLES -->
        <!-- BEGIN THEME LAYOUT STYLES -->
        <link href="{%$VIEW_ROOT%}/assets/layouts/layout/css/layout.min.css" rel="stylesheet" type="text/css" />
        <link href="{%$VIEW_ROOT%}/assets/layouts/layout/css/themes/darkblue.min.css" rel="stylesheet" type="text/css" id="style_color" />
        <link href="{%$VIEW_ROOT%}/assets/layouts/layout/css/custom.min.css" rel="stylesheet" type="text/css" />
        <!-- END THEME LAYOUT STYLES -->
        <link rel="shortcut icon" href="favicon.ico" /> </head>
    <!-- END HEAD -->

    <body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
        <!-- BEGIN HEADER -->
        {%include file='admin/public/header.html'%}
        <!-- END HEADER -->
        <!-- BEGIN HEADER & CONTENT DIVIDER -->
        <div class="clearfix"> </div>
        <!-- END HEADER & CONTENT DIVIDER -->
        <!-- BEGIN CONTAINER -->
        <div class="page-container">
            <!-- BEGIN SIDEBAR -->
            {%include file='admin/public/sidebar.html'%}
            <!-- END SIDEBAR -->
            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEADER-->
                    <!-- BEGIN THEME PANEL -->
                    {%include file='admin/public/style.html'%}
                    <!-- END THEME PANEL -->
                    <!-- BEGIN PAGE BAR -->
                    <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li>
                                <a href="index.php">首页</a>
                                <i class="fa fa-circle"></i>
                            </li>
                            <li>
                                <span>商品管理</span>
								<i class="fa fa-circle"></i>
                            </li>
							<li>
                                <span>首页商品</span>
                            </li>
                        </ul>
                    </div>
                    <!-- END PAGE BAR -->
                    <!-- BEGIN PAGE TITLE-->
                    <h3 class="page-title"> 首页商品
                        <small>首页商品</small>
                    </h3>
                    <!-- END PAGE TITLE-->
                    <!-- END PAGE HEADER-->
                    <div class="portlet light bordered">
						<div class="portlet-title">
							<div class="caption font-dark">
								<i class="icon-settings font-dark"></i>
								<span class="caption-subject bold uppercase"> 商品表</span>
							</div>
						</div>
						<div class="portlet-body">
						<div class="table-toolbar">
							<div class="row">
								<div class="col-md-6">
									<select class="form-control select2" name="name"></select>
								</div>
								<div class="col-md-6">
									<div class="btn-group">
										<button id="create" class="btn sbold green"> 添加商品
											<i class="fa fa-plus"></i>
										</button>
									</div>
								</div>
							</div>
						</div>
						
						<div class="custom-alerts alert alert-danger display-hide fade in">
							<i class="fa-lg fa fa-warning"></i>
							<span id="#alert"></span>
						</div>
						<table id="top" class="table table-hover">
							<thead>
								<tr><th>商品名称</th><th>排序</th><th>操作</th></tr>
							</thead>
							<tbody>
								{%section name=product loop=$product%}
								<tr>
									<td>{%$product[product].name%}</td>
									<td>
										<button data-id="{%$product[product].pid%}" class="btn btn-xs down defualt green-stripe">下</button><button data-id="{%$product[product].pid%}" class="btn btn-xs up defualt green-stripe">上</button>
									</td>
									<td>
										<button class="btn btn-xs red-stripe deafult remove" data-id="{%$product[product].pid%}">删除</button>
									</td>
								</tr>
								{%/section%}
							</tbody>
						</table>
						</div>
					</div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
            <!-- BEGIN QUICK SIDEBAR -->
            {%include file='admin/public/quick_sidebar.html'%}
            <!-- END QUICK SIDEBAR -->
        </div>
        <!-- END CONTAINER -->
        <!-- BEGIN FOOTER -->
        {%include file='admin/public/footer.html'%}
        <!-- END FOOTER -->
        <!--[if lt IE 9]>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/respond.min.js"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
        <!-- BEGIN CORE PLUGINS -->
        <script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
        <!-- END CORE PLUGINS -->
        <!-- BEGIN THEME GLOBAL SCRIPTS -->
        <script src="{%$VIEW_ROOT%}/assets/global/scripts/app.min.js" type="text/javascript"></script>
		<script src="{%$VIEW_ROOT%}/assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
        <!-- END THEME GLOBAL SCRIPTS -->
        <!-- BEGIN THEME LAYOUT SCRIPTS -->
        <script src="{%$VIEW_ROOT%}/assets/layouts/layout/scripts/layout.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/layouts/layout/scripts/demo.min.js" type="text/javascript"></script>
        <script src="{%$VIEW_ROOT%}/assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
        <!-- END THEME LAYOUT SCRIPTS -->
		<script type="text/javascript">
			$.ajaxSetup({
				headers:{
					'X-CSRF-TOKEN':'{%$x_csrf_token%}'
				}
			});
			
			$.fn.select2.defaults.set("theme", "bootstrap");
		
			function formatRepo(repo) {
				
				if (repo.loading) return '载入中...';
	
				var markup = "<div class='select2-result-repository clearfix'>" +
					"<div class='select2-result-repository__avatar'><img src='" + (repo.image==null?'http://placehold.it/50x50':repo.image) + "' /></div>" +
					"<div class='select2-result-repository__meta'>" +
					"<div class='select2-result-repository__title'>" + repo.name + "</div>";
	
				if (repo.short_description) {
					markup += "<div class='select2-result-repository__description'>" + repo.short_description + "</div>";
				}
	
				markup += "<div class='select2-result-repository__statistics'>" +
					"<div class='select2-result-repository__forks'><span class='glyphicon glyphicon-flash'></span> 销售:" + repo.sell + " </div>" +
					"<div class='select2-result-repository__stargazers'><span class='glyphicon glyphicon-star'></span> 价格:" + repo.price + " </div>" +
					"<div class='select2-result-repository__watchers'><span class='glyphicon glyphicon-eye-open'></span> 库存:" + repo.stock + " </div>" +
					"</div>" +
					"</div></div>";
	
				return markup;
			}
	
			function formatRepoSelection(repo) {
				return repo.name;
			}

			$(".select2").select2({
				placeholder: '请选择商品',
				allowClear: true,
				language: {
				   noResults: function(){
					   return "没有找到任何匹配项";
				   },
				   inputTooShort:function(){
					   return '请输入商品名称';
					},
					searching:function(){
						return '正在努力搜索...';
					},
					loadingMore:function(){
						return '载入更多...';
					},
					inputTooLong:function(){
						return '输入太多了...';
					}
			   	},
				ajax: {
					url: "{%url m=ajax c=product a=search%}",
					dataType: 'json',
					delay: 250,
					data: function(params) {
						return {
							keywords: params.term, // search term
							length: params.page
						};
					},
					processResults: function(data, page) {
						return {
							results: data.body.data
						};
					},
					cache: true
				},
				escapeMarkup: function(markup) {
					return markup;
				},
				minimumInputLength: 1,
				templateResult: formatRepo,
				templateSelection: formatRepoSelection
			});
			
			$('#top').on('click','.remove',function(){
				var id = $(this).data('id');
				var ths = $(this);
				$.post('{%url m=ajax c=product a=untop%}',{id:id},function(response){
					if(response.code==1)
					{
						ths.parents('tr').remove();
					}
					else
					{
						App.alert({
							container: $('#alert_container').val(), // alerts parent container 
							place: 'append', // append or prepent in container 
							type: 'danger', // alert's type 
							message: response.result,
							close: true,
							focus: true, // auto scroll to the alert after shown
							closeInSeconds: 3, // auto close after defined seconds 
							icon:'fa fa-remove' // put icon class before the message
						});
					}
				});
			});
			
			function move(id,forward)
			{
				var result;
				$.ajax({
					async:false,
					url:'{%url m=ajax c=product a=topmove%}',
					method:'post',
					data:{
						id:id,
						forward:forward,
					},
					success: function(response){
						result = response.code;
					}
				});
				return result == '1' || result == 1;
			}
			
			$('#top').on('click','.up',function(){
				var id  = $(this).data('id');
				if(move(id,'up'))
				{
					$(this).parents('tr').insertBefore($(this).parents('tr').prev('tr'));
				};
			});
			$('#top').on('click','.down',function(){
				var id  = $(this).data('id');
				if(move(id,'down'))
				{
					$(this).parents('tr').insertAfter($(this).parents('tr').next('tr'));
				};
			});
			
			$('#create').on('click',function(){
				var pid = $('select[name=name]').val();
				if(pid!=null)
				{
					$.post('{%url m=ajax c=product a=top%}',{id:pid},function(response){
						if(response.code==1)
						{
							var tpl = $('<tr><td>'+response.body.name+'</td><td><button data-id="'+response.body.id+'" class="btn btn-xs down defualt yellow-stripe">下</button><button data-id="'+response.body.id+'" class="btn btn-xs up defualt yellow-stripe">上</button></td><td><button class="btn btn-xs red-stripe deafult remove" data-id="'+response.body.id+'">删除</button></td></tr>');
							$('#top tbody').append(tpl);
						}
						else
						{
							App.alert({
								container: $('#alert_container').val(), // alerts parent container 
								place: 'append', // append or prepent in container 
								type: 'danger', // alert's type 
								message: response.result,
								close: true,
								focus: true, // auto scroll to the alert after shown
								closeInSeconds: 3, // auto close after defined seconds 
								icon:'fa fa-remove' // put icon class before the message
							});
						}
					});
				}
				return false;
			});
		</script>
    </body>

</html>